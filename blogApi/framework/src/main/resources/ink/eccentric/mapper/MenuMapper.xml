<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ink.eccentric.mapper.MenuMapper">

    <select id="getRootMenus" resultType="ink.eccentric.domain.vo.menu.RoutesVo">
        <if test="rolesId.contains(1)">
            select * from sys_menu
            where parent_id=0
              and del_flag=0
              and status=0
              and menu_type in ('M','C')
            order by parent_id,order_num
        </if>
        <if test="!rolesId.contains(1)">
            select distinct sm.* from sys_role_menu srm
            left join sys_menu sm on srm.menu_id = sm.id
            where srm.role_id in
            <foreach item="item" index="index" collection="rolesId" open="("
                     separator="," close=")">
                  #{item}
            </foreach>
            and sm.id is not null
            and sm.del_flag=0
            and sm.status=0
            and sm.parent_id=0
            and sm.menu_type in ('M','C')
            order by sm.parent_id,sm.order_num
        </if>
    </select>

    <select id="getChildren" resultType="ink.eccentric.domain.vo.menu.RoutesVo">
        <if test="rolesId.contains(1)">
            select * from sys_menu
            where parent_id=#{parentId}
              and del_flag=0
              and status=0
              and menu_type in ('M','C')
            order by parent_id,order_num
        </if>
        <if test="!rolesId.contains(1)">
            select distinct sm.* from sys_role_menu srm
            left join sys_menu sm on srm.menu_id = sm.id
            where srm.role_id in
            <foreach item="item" index="index" collection="rolesId" open="("
                     separator="," close=")">
                #{item}
            </foreach>
            and sm.id is not null
            and sm.del_flag=0
            and sm.status=0
            and sm.parent_id=#{parentId}
            and sm.menu_type in ('M','C')
            order by sm.parent_id,sm.order_num
        </if>
    </select>

</mapper>
